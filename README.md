# MobileSuica Payments History → PayPay Payments History CSV for MoneyForward (PHP)

モバイルSuicaのSF利用履歴（タブ区切りテキスト）を  
**MoneyForward（マネーフォワード）PayPay取り込み用CSV形式** に変換する  
**PHP CLIツール**です。

- 自動分割対応

---

## 🇯🇵 日本語

### 概要

このツールは、モバイルSuicaのSF利用履歴（タブ区切りテキスト）を読み込み、  
マネーフォワードに取り込めるCSV形式に変換します。

モバイルSuica履歴には **年号や時刻が存在しない** ため、以下のルールで補完します。

---

### 主な仕様

#### 日付・時刻
- 年号は **指定した年（デフォルト：現在年）**
- 未来日付が出た場合は **前年扱い**
- 同一日の取引は  
  **10:00:00 から 1分ずつ減算**（10:00 → 09:59 → 09:58 …）

#### 金額
- マイナス → 支出（出金金額）
- プラス → チャージ（入金金額）

#### 取引先
```

{種別1} {利用場所1} {種別2} {利用場所2}

```
（空要素は自動除去）

#### 固定値
- 取引内容  
  - 支出：`支払い`
  - 入金：`チャージ`
- 取引方法  
  - 支出：`Suica`
  - 入金：`VIEWカード`
- 利用者  
  - 支出：`本人`
  - 入金：`-`
- 海外関連項目・支払い区分：すべて `-`

#### 取引番号
- 重複しないランダム値
- **ハイフンなし**
- 形式例：
```

YYYYMMDD + 連番 + ランダム文字列

```

---

### CSV分割仕様

- **1ファイル最大100行（ヘッダ含む）**
- 超えた場合は自動で分割
- 出力例：
```

save_001.csv
save_002.csv
save_003.csv

````

各CSVには必ず
- UTF-8 BOM
- ヘッダ行  
が含まれます。

---

### 対応PHPバージョン

- PHP **8.2 以上推奨**

---

### 使い方

```bash
php moneyforward_convert.php --in=load.txt --out=save.csv
````

#### オプション

| オプション            | 説明                     |
| ---------------- | ---------------------- |
| `--in=FILE`      | 入力TSVファイル              |
| `--out=FILE`     | 出力CSVのベース名             |
| `--expense-only` | **支出（マイナス）のみ出力**       |

#### 例：支出のみ変換

```bash
php moneyforward_convert.php --expense-only
```

---

### 入力TSV形式（想定）

```
月日    種別1  利用場所1  種別2  利用場所2  残高  入金・利用額
01/24  物販   コンビニ              3,210  -389
```

※ 列数が不足している行は自動補完されます
※ 文字コードは UTF-8 / SJIS-win / CP932 を自動判定

---

### 注意事項

* このツールは **非公式** です。
* モバイルSuicaサイトのデザイン変更により動かなくなる可能性があります。
* 入金種別が「VIEWカード」固定になっているので適宜書き換える必要があるかもしれません。
* 生成されたCSVの年があっているか確認してください。

---

## License

MIT License
